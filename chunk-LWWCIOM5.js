import{a as w}from"./chunk-2V7QFTYQ.js";import{e as k}from"./chunk-IJ4Z7FZT.js";import{Eb as S,I as h,Lb as T,Sb as b,Ub as y,da as a,fa as p,ga as g,la as f,mb as u,ra as d,sb as _,tb as v,zb as C}from"./chunk-YSNUVGWI.js";var I={formId:"commercetag",title:"Commercetag",components:[{name:"Text",key:"name",focused:!0,fields:[{name:"Placeholder",value:"fill commercetag title"},{name:"Label",value:"Title"}]},{name:"Text",key:"description",fields:[{name:"Placeholder",value:"fill commercetag description"},{name:"Label",value:"Description"}]},{name:"Photo",key:"thumb",fields:[{name:"Label",value:"Header picture"}]}]};var n=(()=>{class r{get allTags(){return this.parent?this._commercetagService.commercetagsByParent[this.parent]:this.commerce?this._commercetagService.commercetagsByCommerce[this.commerce]:this._commercetagService.commercetags.filter(e=>!e.parent)}setTags(){this.tags.splice(0,this.tags.length);for(let e of this._commercetagService.commercetags)!this.commerce&&!this.parent?e.parent||this.tags.push(e):this.commerce&&this.parent?e.parent===this.parent&&e.commerce===this.commerce&&this.tags.push(e):this.parent?e.parent===this.parent&&this.tags.push(e):e.commerce===this.commerce&&!e.parent&&this.tags.push(e)}childrenUrl(e){return"/"+["commerce","commercetags","parent",e._id].join("/")}update(e){this._commercetagService.update(e)}constructor(e,c,t,m,l,M){this._translate=e,this._commercetagService=c,this.route=t,this._alert=m,this._form=l,this._core=M,this.commerce="",this.parent="",this.columns=["name"],this.form=this._form.getForm("commercetag",I),this.config={create:()=>{this._form.modal(this.form,{label:"Create",click:(i,s)=>{let o=i;this.commerce&&(o.commerce=this.commerce),this.parent&&(o.parent=this.parent),console.log("Creating tag with commerce:",o),this._commercetagService.create(o,{callback:()=>{console.log("Commercetag created successfully"),this.setTags()}}),s()}})},update:i=>{this._form.modal(this.form,[],i).then(s=>{this._core.copy(s,i),this._commercetagService.update(i,{callback:()=>{this.setTags()}})})},delete:i=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this commercetag?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>{this._commercetagService.delete(i,{callback:()=>{this.setTags()}})}}]})},buttons:[{icon:"label_important",hrefFunc:this.childrenUrl.bind(this)},{icon:"arrow_upward",click:i=>{let s=this.allTags.findIndex(o=>o._id===i._id);[this.allTags[s],this.allTags[s-1]]=[this.allTags[s-1],this.allTags[s]];for(let o=0;o<this.allTags.length;o++)this.allTags[o].order!==o&&(this.allTags[o].order=o,this._commercetagService.update(this.allTags[o]))}},{icon:"cloud_download",click:i=>{this._form.modalUnique("commercetag","url",i)}}],headerButtons:[{icon:"playlist_add",click:this._bulkManagement(),class:"playlist"},{icon:"edit_note",click:this._bulkManagement(!1),class:"edit"}]},this.tags=JSON.parse(JSON.stringify(this._commercetagService.commercetags)),this.route.paramMap.subscribe(i=>{this.commerce=i.get("commerce_id")||v.commerceId||"",console.log(this.commerce),this.parent=i.get("parent")||"",console.log(this.parent)})}ngOnInit(){this.setTags()}_bulkManagement(e=!0){return()=>{this._form.modalDocs(e?[]:this.tags).then(c=>{if(e)for(let t of c)this.commerce&&(t.commerce=this.commerce),this._commercetagService.create(t);else{for(let t of this.tags)c.find(m=>m._id===t._id)||this._commercetagService.delete(t);for(let t of c){let m=this.tags.find(l=>l._id===t._id);m?(this._core.copy(t,m),this._commercetagService.update(m)):(this.commerce&&(t.commerce=this.commerce),t.__created=!1,this._commercetagService.create(t))}}})}}static{this.\u0275fac=function(c){return new(c||r)(a(T),a(w),a(u),a(S),a(y),a(C))}}static{this.\u0275cmp=p({type:r,selectors:[["ng-component"]],standalone:!1,decls:1,vars:3,consts:[["title","\u0422\u0435\u0433\u0438",3,"columns","config","rows"]],template:function(c,t){c&1&&d(0,"wtable",0),c&2&&f("columns",t.columns)("config",t.config)("rows",t.allTags)},dependencies:[b],encapsulation:2})}}return r})();var x=[{path:"",component:n},{path:"parent/:parent",component:n},{path:"commerce/:commerce_id",component:n},{path:":commerce_id/:parent",component:n}],Y=(()=>{class r{static{this.\u0275fac=function(c){return new(c||r)}}static{this.\u0275mod=g({type:r})}static{this.\u0275inj=h({imports:[_.forChild(x),k]})}}return r})();export{Y as CommercetagsModule};
