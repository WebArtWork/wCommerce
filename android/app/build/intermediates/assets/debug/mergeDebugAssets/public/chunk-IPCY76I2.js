import{a as I}from"./chunk-FKDPHDS3.js";import{a as S}from"./chunk-HZVGXVXD.js";import{e as w}from"./chunk-QJDHHX4S.js";import{Bb as k,L as m,M as h,N as p,S as f,Va as g,Y as v,Za as _,_a as y,a as n,b as u,fb as b,kb as P,s as d,sb as T,zb as C}from"./chunk-CNPABYXW.js";var l=(()=>{class i{constructor(e,t,r,c,a,L,x){this._tagService=e,this._translate=t,this._commerceproductService=r,this._alert=c,this._form=a,this._core=L,this._router=x,this.tags=[],this.columns=["name","tags"],this.commerce=this._router.url.includes("/commerce/commerceproducts/")?this._router.url.replace("/commerce/commerceproducts/",""):y.commerceId||"",this.form=this._form.getForm("commerceproduct",{formId:"commerceproduct",title:"Commerceproduct",components:[{name:"Text",key:"name",focused:!0,fields:[{name:"Placeholder",value:"fill commerceproduct title"},{name:"Label",value:"Title"}]},{name:"Text",key:"description",fields:[{name:"Placeholder",value:"fill commerceproduct description"},{name:"Label",value:"Description"}]},{name:"Text",key:"country",fields:[{name:"Placeholder",value:"fill commerceproduct country"},{name:"Label",value:"Country"}]},{name:"Number",key:"volume",fields:[{name:"Placeholder",value:"fill commerceproduct volume"},{name:"Label",value:"Volume"}]},{name:"Number",key:"weight",fields:[{name:"Placeholder",value:"fill commerceproduct weight"},{name:"Label",value:"Weight"}]},{name:"Text",key:"battery",fields:[{name:"Placeholder",value:"fill commerceproduct battery"},{name:"Label",value:"Battery"}]},{name:"Text",key:"power",fields:[{name:"Placeholder",value:"fill commerceproduct power"},{name:"Label",value:"Power"}]},{name:"Text",key:"atomizerType",fields:[{name:"Placeholder",value:"fill commerceproduct atomizerType"},{name:"Label",value:"AtomizerType"}]},{name:"Text",key:"warranty",fields:[{name:"Placeholder",value:"fill commerceproduct warranty"},{name:"Label",value:"Warranty"}]},{name:"Text",key:"type",fields:[{name:"Placeholder",value:"fill commerceproduct type"},{name:"Label",value:"Type"}]},{name:"Number",key:"price",fields:[{name:"Placeholder",value:"fill commerceproduct price"},{name:"Label",value:"Price"}]},{name:"Photo",key:"thumb",fields:[{name:"Label",value:"Header picture"}]},{name:"Photos",key:"thumbs",fields:[{name:"Label",value:"Detailed pictures"}]},{name:"Select",key:"tags",fields:[{name:"Placeholder",value:"fill product tag"},{name:"Label",value:"Tag"},{name:"Multiple",value:!0},{name:"Items",value:this.tags}]}]}),this.config={paginate:this.setProducts.bind(this),perPage:20,setPerPage:this._commerceproductService.setPerPage.bind(this._commerceproductService),allDocs:!1,create:()=>{this._form.modal(this.form,{label:"Create",click:(o,s)=>{this.commerce&&(o.commerce=this.commerce),this._commerceproductService.create(o),this.setProducts(),s()}})},update:o=>{this._form.modal(this.form,[],o).then(s=>{this._core.copy(s,o),this._commerceproductService.update(o)})},delete:o=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this commerceproduct?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>{this._commerceproductService.delete(o),this.setProducts()}}]})},buttons:[{icon:"1x_mobiledata",hrefFunc:o=>"/commerce/commerceproductquantities/product/"+o._id},{icon:"cloud_download",click:o=>{this._form.modalUnique("commerceproduct","url",o)}}],headerButtons:[{icon:"playlist_add",click:this._bulkManagement(),class:"playlist"},{icon:"edit_note",click:this._bulkManagement(!1),class:"edit"}]},this.rows=[],this._page=1,this.setTags()}setProducts(e=this._page){this._page=e,this._core.afterWhile(this,()=>{this._commerceproductService.get({page:e}).subscribe(t=>{this.rows=t})},250)}getTags(e){return e.tags?.map(t=>this.tags.find(r=>r._id===t)?.name).filter(t=>t).join(", ")||"No tags"}tagIncludeCommerce(e){return e.commerce===this.commerce}tagName(e){let t=e.name;for(;e.parent;)e=this._tagService.doc(e.parent),t=e.name+" / "+t;return t}setTags(){this.tags.splice(0,this.tags.length);for(let e of this._tagService.commercetags)this.tagIncludeCommerce(e)&&this.tags.push(u(n({},e),{name:this.tagName(e)}));this.tags.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:0),this.setProducts()}replaceTagsWithIds(e){e.tags&&(e.tags=e.tags.map(t=>{let r=this.tags.find(c=>c.name==t);return r?r._id:t}))}_bulkManagement(e=!0){return()=>{this._form.modalDocs(e?[]:this.rows).then(t=>{if(e){console.log(t);for(let r of t)this.commerce&&(r.commerce=this.commerce),this.replaceTagsWithIds(r),this._commerceproductService.create(r)}else{for(let r of this.rows)t.some(c=>c._id===r._id)||this._commerceproductService.delete(r);for(let r of t){let c=this.rows.find(a=>a._id===r._id);c?(this.replaceTagsWithIds(r),this._core.copy(r,c),this._commerceproductService.update(c)):(this.commerce&&(r.commerce=this.commerce),this.replaceTagsWithIds(r),r.__created=!1,this._commerceproductService.create(r))}}this.setProducts()})}}static{this.\u0275fac=function(t){return new(t||i)(m(S),m(T),m(I),m(P),m(k),m(b),m(g))}}static{this.\u0275cmp=h({type:i,selectors:[["ng-component"]],standalone:!1,decls:1,vars:3,consts:[["title","Products",3,"columns","config","rows"]],template:function(t,r){t&1&&v(0,"wtable",0),t&2&&f("columns",r.columns)("config",r.config)("rows",r.rows)},dependencies:[C],encapsulation:2})}}return i})();var j=[{path:"",component:l},{path:":commerce_id",component:l}],E=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=p({type:i})}static{this.\u0275inj=d({imports:[_.forChild(j),w]})}}return i})();export{E as CommerceproductsModule};
